Started by user Andrey G.
Running in Durability level: MAX_SURVIVABILITY
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/pipeline02
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Tool Install)
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Git clone)
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] withEnv
[Pipeline] {
[Pipeline] git
The recommended git tool is: NONE
using credential 9ca0aa0b-692c-4bd9-a70e-3933625bae8f
 > git rev-parse --is-inside-work-tree # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/andgre/VerificationTask # timeout=10
Fetching upstream changes from https://github.com/andgre/VerificationTask
 > git --version # timeout=10
 > git --version # 'git version 2.25.1'
using GIT_ASKPASS to set credentials git credentials
 > git fetch --tags --force --progress -- https://github.com/andgre/VerificationTask +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision 8eab9c7cfe682b49619374cc24f560fd8e1f604c (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 8eab9c7cfe682b49619374cc24f560fd8e1f604c # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D master # timeout=10
 > git checkout -b master 8eab9c7cfe682b49619374cc24f560fd8e1f604c # timeout=10
Commit message: "commit"
 > git rev-list --no-walk fdc94bcff321f64201045459334de30f28fd90ce # timeout=10
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Terraform init)
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ terraform init

[0m[1mInitializing the backend...[0m

[0m[1mInitializing provider plugins...[0m
- Reusing previous version of hashicorp/google from the dependency lock file
- Reusing previous version of hashicorp/null from the dependency lock file
- Using previously-installed hashicorp/google v3.60.0
- Using previously-installed hashicorp/null v3.1.0

[33m
[1m[33mWarning: [0m[0m[1mInterpolation-only expressions are deprecated[0m

[0m  on main.tf line 67, in resource "google_compute_instance" "prod":
  67:     private_key = [4m"${file("~/.ssh/id_rsa")}"[0m
[0m
Terraform 0.11 and earlier required all non-constant expressions to be
provided via interpolation syntax, but this pattern is now deprecated. To
silence this warning, remove the "${ sequence from the start and the }"
sequence from the end of this expression, leaving just the inner expression.

Template interpolation syntax is still used to construct strings from
expressions when the template includes multiple interpolation sequences or a
mixture of literal strings and interpolations. This deprecation applies only
to templates that consist entirely of a single interpolation sequence.
[0m[0m
[0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
[0m[32m
You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.[0m
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Terraform apply)
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ terraform apply --auto-approve
[0m[1mgoogle_compute_instance.prod: Refreshing state... [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-prod-001][0m
[0m[1mgoogle_compute_instance.dev: Creating...[0m[0m
[0m[1mgoogle_compute_instance.prod: Creating...[0m[0m
[0m[1mgoogle_compute_instance.dev: Still creating... [10s elapsed][0m[0m
[0m[1mgoogle_compute_instance.prod: Still creating... [10s elapsed][0m[0m
[0m[1mgoogle_compute_instance.prod: Provisioning with 'remote-exec'...[0m[0m
[0m[0mgoogle_compute_instance.prod (remote-exec): Connecting to remote host via SSH...
google_compute_instance.prod (remote-exec):   Host: 35.228.16.221
google_compute_instance.prod (remote-exec):   User: root
google_compute_instance.prod (remote-exec):   Password: false
google_compute_instance.prod (remote-exec):   Private key: true
google_compute_instance.prod (remote-exec):   Certificate: false
google_compute_instance.prod (remote-exec):   SSH Agent: false
google_compute_instance.prod (remote-exec):   Checking Host Key: false
google_compute_instance.prod (remote-exec):   Target Platform: unix
[0m[1mgoogle_compute_instance.dev: Provisioning with 'remote-exec'...[0m[0m
[0m[0mgoogle_compute_instance.dev (remote-exec): Connecting to remote host via SSH...
google_compute_instance.dev (remote-exec):   Host: 35.228.93.183
google_compute_instance.dev (remote-exec):   User: root
google_compute_instance.dev (remote-exec):   Password: false
google_compute_instance.dev (remote-exec):   Private key: true
google_compute_instance.dev (remote-exec):   Certificate: false
google_compute_instance.dev (remote-exec):   SSH Agent: false
google_compute_instance.dev (remote-exec):   Checking Host Key: false
google_compute_instance.dev (remote-exec):   Target Platform: unix
[0m[1mgoogle_compute_instance.dev: Still creating... [20s elapsed][0m[0m
[0m[1mgoogle_compute_instance.prod: Still creating... [20s elapsed][0m[0m
[0m[0mgoogle_compute_instance.prod (remote-exec): Connected!
[0m[0mgoogle_compute_instance.dev (remote-exec): Connected!
[0m[0mgoogle_compute_instance.prod (remote-exec): Linux instance-prod-001 4.19.0-14-cloud-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64 GNU/Linux
[0m[1mgoogle_compute_instance.prod: Creation complete after 21s [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-prod-001][0m[0m
[0m[0mgoogle_compute_instance.dev (remote-exec): Linux instance-dev-001 4.19.0-14-cloud-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64 GNU/Linux
[0m[1mgoogle_compute_instance.dev: Creation complete after 21s [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-dev-001][0m[0m
[0m[1mnull_resource.localexec: Creating...[0m[0m
[0m[1mnull_resource.localexec: Provisioning with 'local-exec'...[0m[0m
[0m[0mnull_resource.localexec (local-exec): Executing: ["/bin/sh" "-c" "ansible-playbook -v playbook.yml --extra-vars 'dev_ip=35.228.93.183 prod_ip=35.228.16.221'"]
[0m[0mnull_resource.localexec (local-exec): Using /etc/ansible/ansible.cfg as config file
[0m[0mnull_resource.localexec (local-exec): [WARNING]: provided hosts list is empty, only localhost is available. Note that
[0m[0mnull_resource.localexec (local-exec): the implicit localhost does not match 'all'
[0m[0m
[0m[0mnull_resource.localexec (local-exec): PLAY [Start] *******************************************************************
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Add new dev instances to host group] *************************************
[0m[0mnull_resource.localexec (local-exec): changed: [localhost] => {"add_host": {"groups": ["dev"], "host_name": "35.228.93.183", "host_vars": {"ansible_ssh_private_key_file": "~/.ssh/id_rsa", "ansible_ssh_user": "root"}}, "changed": true}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Add new prod instances to host group] ************************************
[0m[0mnull_resource.localexec (local-exec): changed: [localhost] => {"add_host": {"groups": ["prod"], "host_name": "35.228.16.221", "host_vars": {"ansible_ssh_private_key_file": "~/.ssh/id_rsa", "ansible_ssh_user": "root"}}, "changed": true}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): PLAY [install Dev enviroment] **************************************************
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Gathering Facts] *********************************************************
[0m[0mnull_resource.localexec (local-exec): [WARNING]: Platform linux on host 35.228.93.183 is using the discovered Python
[0m[0mnull_resource.localexec (local-exec): interpreter at /usr/bin/python3.7, but future installation of another Python
[0m[0mnull_resource.localexec (local-exec): interpreter could change this. See https://docs.ansible.com/ansible/2.9/referen
[0m[0mnull_resource.localexec (local-exec): ce_appendices/interpreter_discovery.html for more information.
[0m[0mnull_resource.localexec (local-exec): ok: [35.228.93.183]
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Ensure Dev-apps are present] *********************************************
[0m[1mnull_resource.localexec: Still creating... [10s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [20s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [30s elapsed][0m[0m
[0m[0m
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [git clone java app] ******************************************************
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.93.183] => {"after": "4011fe153a243ab5f34b27c9897fb3a898824b90", "before": null, "changed": true}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [change pom.xml] **********************************************************
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.93.183] => {"backup": "", "changed": true, "msg": "line replaced"}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [build app] ***************************************************************
[0m[1mnull_resource.localexec: Still creating... [40s elapsed][0m[0m
[0m[0m
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Configure ssh] ***********************************************************
[0m[1mnull_resource.localexec: Still creating... [50s elapsed][0m[0m
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.93.183] => {"changed": true, "checksum": "6c3a5d4d420827089489ae850cd10ec406f87773", "dest": "/root/.ssh/id_rsa", "gid": 0, "group": "root", "md5sum": "bd28d314c832d1d32f2fc4c5de005209", "mode": "0600", "owner": "root", "size": 2602, "src": "/root/.ansible/tmp/ansible-tmp-1616355254.8357177-174462925416320/source", "state": "file", "uid": 0}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): PLAY [install Prod enviroment] *************************************************
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Gathering Facts] *********************************************************
[0m[0mnull_resource.localexec (local-exec): [WARNING]: Platform linux on host 35.228.16.221 is using the discovered Python
[0m[0mnull_resource.localexec (local-exec): interpreter at /usr/bin/python3.7, but future installation of another Python
[0m[0mnull_resource.localexec (local-exec): interpreter could change this. See https://docs.ansible.com/ansible/2.9/referen
[0m[0mnull_resource.localexec (local-exec): ce_appendices/interpreter_discovery.html for more information.
[0m[0mnull_resource.localexec (local-exec): ok: [35.228.16.221]
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Ensure Prod-apps are present] ********************************************
[0m[1mnull_resource.localexec: Still creating... [1m0s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [1m10s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [1m20s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [1m30s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [1m40s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [1m50s elapsed][0m[0m
[0m[0m
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Pip install docker] ******************************************************
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.16.221] => {"changed": true, "cmd": ["pip3", "install", "docker"], "delta": "0:00:02.436813", "end": "2021-03-21 19:35:25.262619", "rc": 0, "start": "2021-03-21 19:35:22.825806", "stderr": "", "stderr_lines": [], "stdout": "Collecting docker\n  Downloading https://files.pythonhosted.org/packages/c4/22/410313ad554477e87ec406d38d85f810e61ddb0d2fc44e64994857476de9/docker-4.4.4-py2.py3-none-any.whl (147kB)\nCollecting websocket-client>=0.32.0 (from docker)\n  Downloading https://files.pythonhosted.org/packages/08/33/80e0d4f60e84a1ddd9a03f340be1065a2a363c47ce65c4bd3bae65ce9631/websocket_client-0.58.0-py2.py3-none-any.whl (61kB)\nRequirement already satisfied: six>=1.4.0 in /usr/lib/python3/dist-packages (from docker) (1.12.0)\nCollecting requests!=2.18.0,>=2.14.2 (from docker)\n  Downloading https://files.pythonhosted.org/packages/29/c1/24814557f1d22c56d50280771a17307e6bf87b70727d975fd6b2ce6b014a/requests-2.25.1-py2.py3-none-any.whl (61kB)\nCollecting urllib3<1.27,>=1.21.1 (from requests!=2.18.0,>=2.14.2->docker)\n  Downloading https://files.pythonhosted.org/packages/09/c6/d3e3abe5b4f4f16cf0dfc9240ab7ce10c2baa0e268989a4e3ec19e90c84e/urllib3-1.26.4-py2.py3-none-any.whl (153kB)\nCollecting idna<3,>=2.5 (from requests!=2.18.0,>=2.14.2->docker)\n  Downloading https://files.pythonhosted.org/packages/a2/38/928ddce2273eaa564f6f50de919327bf3a00f091b5baba8dfa9460f3a8a8/idna-2.10-py2.py3-none-any.whl (58kB)\nCollecting certifi>=2017.4.17 (from requests!=2.18.0,>=2.14.2->docker)\n  Downloading https://files.pythonhosted.org/packages/5e/a0/5f06e1e1d463903cf0c0eebeb751791119ed7a4b3737fdc9a77f1cdfb51f/certifi-2020.12.5-py2.py3-none-any.whl (147kB)\nCollecting chardet<5,>=3.0.2 (from requests!=2.18.0,>=2.14.2->docker)\n  Downloading https://files.pythonhosted.org/packages/19/c7/fa589626997dd07bd87d9269342ccb74b1720384a4d739a1872bd84fbe68/chardet-4.0.0-py2.py3-none-any.whl (178kB)\nInstalling collected packages: websocket-client, urllib3, idna, certifi, chardet, requests, docker\nSuccessfully installed certifi-2020.12.5 chardet-4.0.0 docker-4.4.4 idna-2.10 requests-2.25.1 urllib3-1.26.4 websocket-client-0.58.0", "stdout_lines": ["Collecting docker", "  Downloading https://files.pythonhosted.org/packages/c4/22/410313ad554477e87ec406d38d85f810e61ddb0d2fc44e64994857476de9/docker-4.4.4-py2.py3-none-any.whl (147kB)", "Collecting websocket-client>=0.32.0 (from docker)", "  Downloading https://files.pythonhosted.org/packages/08/33/80e0d4f60e84a1ddd9a03f340be1065a2a363c47ce65c4bd3bae65ce9631/websocket_client-0.58.0-py2.py3-none-any.whl (61kB)", "Requirement already satisfied: six>=1.4.0 in /usr/lib/python3/dist-packages (from docker) (1.12.0)", "Collecting requests!=2.18.0,>=2.14.2 (from docker)", "  Downloading https://files.pythonhosted.org/packages/29/c1/24814557f1d22c56d50280771a17307e6bf87b70727d975fd6b2ce6b014a/requests-2.25.1-py2.py3-none-any.whl (61kB)", "Collecting urllib3<1.27,>=1.21.1 (from requests!=2.18.0,>=2.14.2->docker)", "  Downloading https://files.pythonhosted.org/packages/09/c6/d3e3abe5b4f4f16cf0dfc9240ab7ce10c2baa0e268989a4e3ec19e90c84e/urllib3-1.26.4-py2.py3-none-any.whl (153kB)", "Collecting idna<3,>=2.5 (from requests!=2.18.0,>=2.14.2->docker)", "  Downloading https://files.pythonhosted.org/packages/a2/38/928ddce2273eaa564f6f50de919327bf3a00f091b5baba8dfa9460f3a8a8/idna-2.10-py2.py3-none-any.whl (58kB)", "Collecting certifi>=2017.4.17 (from requests!=2.18.0,>=2.14.2->docker)", "  Downloading https://files.pythonhosted.org/packages/5e/a0/5f06e1e1d463903cf0c0eebeb751791119ed7a4b3737fdc9a77f1cdfb51f/certifi-2020.12.5-py2.py3-none-any.whl (147kB)", "Collecting chardet<5,>=3.0.2 (from requests!=2.18.0,>=2.14.2->docker)", "  Downloading https://files.pythonhosted.org/packages/19/c7/fa589626997dd07bd87d9269342ccb74b1720384a4d739a1872bd84fbe68/chardet-4.0.0-py2.py3-none-any.whl (178kB)", "Installing collected packages: websocket-client, urllib3, idna, certifi, chardet, requests, docker", "Successfully installed certifi-2020.12.5 chardet-4.0.0 docker-4.4.4 idna-2.10 requests-2.25.1 urllib3-1.26.4 websocket-client-0.58.0"]}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Getting artifact] ********************************************************
[0m[1mnull_resource.localexec: Still creating... [2m0s elapsed][0m[0m
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.16.221 -> 35.228.93.183] => {"changed": true, "cmd": "/usr/bin/rsync --delay-updates -F --compress --archive --rsh=/usr/bin/ssh -S none -i /root/.ssh/id_rsa -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --rsync-path=sudo rsync --out-format=<<CHANGED>>%i %n%L /opt/myapp/target/Puzzle15-1.0-SNAPSHOT.war root@35.228.16.221:/root/Puzzle15-1.0-SNAPSHOT.war", "msg": "<f+++++++++ Puzzle15-1.0-SNAPSHOT.war\n", "rc": 0, "stdout_lines": ["<f+++++++++ Puzzle15-1.0-SNAPSHOT.war"]}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Push Dockerfile] *********************************************************
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.16.221] => {"changed": true, "checksum": "60873213f61912896e57aff60c3393678330e98f", "dest": "/root/Dockerfile", "gid": 0, "group": "root", "md5sum": "c98f54746b91e4eb33c5f389e09f1763", "mode": "0644", "owner": "root", "size": 890, "src": "/root/.ansible/tmp/ansible-tmp-1616355326.1046083-20166020478425/source", "state": "file", "uid": 0}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Build image] *************************************************************
[0m[1mnull_resource.localexec: Still creating... [2m10s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [2m20s elapsed][0m[0m
[0m[1mnull_resource.localexec: Still creating... [2m30s elapsed][0m[0m
[0m[0mnull_resource.localexec (local-exec): [WARNING]: The default for build.pull is currently 'yes', but will be changed
[0m[0mnull_resource.localexec (local-exec): to 'no' in Ansible 2.12. Please set build.pull explicitly to the value you
[0m[0mnull_resource.localexec (local-exec): need.
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.16.221] => {"actions": ["Built image prodimg:latest from /root"], "changed": true, "image": {"Architecture": "amd64", "Author": "", "Comment": "", "Config": {"AttachStderr": false, "AttachStdin": false, "AttachStdout": false, "Cmd": null, "Domainname": "", "Entrypoint": ["catalina.sh", "run"], "Env": ["PATH=/opt/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TOMCAT_MAJOR=9", "TOMCAT_VERSION=9.0.43", "CATALINA_HOME=/opt/tomcat"], "ExposedPorts": {"8080/tcp": {}}, "Hostname": "", "Image": "sha256:1339d97977aee212b0dd4a16ed67fffcab9fcf7f70097e27422bb3e7bb96d262", "Labels": null, "OnBuild": null, "OpenStdin": false, "StdinOnce": false, "Tty": false, "User": "", "Volumes": null, "WorkingDir": "/opt/tomcat"}, "Container": "b569342b1d27eadaa9df964b14ee892c57af036123378f089a2abdb0c21dd8fa", "ContainerConfig": {"AttachStderr": false, "AttachStdin": false, "AttachStdout": false, "Cmd": ["/bin/sh", "-c", "#(nop) ", "ENTRYPOINT [\"catalina.sh\" \"run\"]"], "Domainname": "", "Entrypoint": ["catalina.sh", "run"], "Env": ["PATH=/opt/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TOMCAT_MAJOR=9", "TOMCAT_VERSION=9.0.43", "CATALINA_HOME=/opt/tomcat"], "ExposedPorts": {"8080/tcp": {}}, "Hostname": "b569342b1d27", "Image": "sha256:1339d97977aee212b0dd4a16ed67fffcab9fcf7f70097e27422bb3e7bb96d262", "Labels": {}, "OnBuild": null, "OpenStdin": false, "StdinOnce": false, "Tty": false, "User": "", "Volumes": null, "WorkingDir": "/opt/tomcat"}, "Created": "2021-03-21T19:35:59.735220399Z", "DockerVersion": "18.09.1", "GraphDriver": {"Data": {"LowerDir": "/var/lib/docker/overlay2/8a71216a59975a7f2d5d3b882cdcc1d40c87feda4f687c879f7a429ec9a505c9/diff:/var/lib/docker/overlay2/1d6f1bbc7ae4ac29583bba9b0554a301881421a9c2298558c96a235d08436824/diff:/var/lib/docker/overlay2/cf7dbad0b45ccf86c1b07e9838ea67b3476bab016d585c6aed3fb3cd11235317/diff:/var/lib/docker/overlay2/37a9c59931bb7952f7047148bab7d7f278dde78f0abf4fed70399f5dffb7a13f/diff:/var/lib/docker/overlay2/356dc8b6f2576afa3811c6e630a6cd81e9b266fb64ab3f741cf61021a5119ec9/diff:/var/lib/docker/overlay2/5629846b4ba98079b43546ea490c089b6ddeb5a916fe4c72c795fe47233c1f0f/diff", "MergedDir": "/var/lib/docker/overlay2/613a8587ad1136ad9a7bcf2c2cb9bee0e5235bec97f87350fecf185ff59fd3e4/merged", "UpperDir": "/var/lib/docker/overlay2/613a8587ad1136ad9a7bcf2c2cb9bee0e5235bec97f87350fecf185ff59fd3e4/diff", "WorkDir": "/var/lib/docker/overlay2/613a8587ad1136ad9a7bcf2c2cb9bee0e5235bec97f87350fecf185ff59fd3e4/work"}, "Name": "overlay2"}, "Id": "sha256:d9d0a2b89cd075127dcbf2a810acc7edf167f5ffe3902ab4fd1a1bf59b9bc5cd", "Metadata": {"LastTagTime": "2021-03-21T19:35:59.78858168Z"}, "Os": "linux", "Parent": "sha256:1339d97977aee212b0dd4a16ed67fffcab9fcf7f70097e27422bb3e7bb96d262", "RepoDigests": [], "RepoTags": ["prodimg:latest"], "RootFS": {"Layers": ["sha256:cb381a32b2296e4eb5af3f84092a2e6685e88adbc54ee0768a1a1010ce6376c7", "sha256:d735ca3dbeaa49af177679fed97d0060ef57f4d3c6d9e466a9d7db4031ed3758", "sha256:02c0dd37241d1801a8436369b8eaa310f86ec6bbe624c3e6d02e7be93e7c943c", "sha256:3550ff263c644daaeb6bcbb3bdfbc38d16950512fa0e8e731330ee5fab30c6b4", "sha256:82ca49e53fcf22820d415930128c677aeb505e6421eb6e824b30ed81f9ac2e63", "sha256:f2c8db307303e05a408e268a2151d86906aaf372a7c81342665ec66777e48f0b", "sha256:79b6e55c1e9c0532263ca75107b659290033e625f9b58d00ab62d52e17cde66b"], "Type": "layers"}, "Size": 327915508, "VirtualSize": 327915508}}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): TASK [Start docker container] **************************************************
[0m[0mnull_resource.localexec (local-exec): changed: [35.228.16.221] => {"ansible_facts": {"docker_container": {"AppArmorProfile": "docker-default", "Args": ["run"], "Config": {"AttachStderr": false, "AttachStdin": false, "AttachStdout": false, "Cmd": null, "Domainname": "", "Entrypoint": ["catalina.sh", "run"], "Env": ["PATH=/opt/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TOMCAT_MAJOR=9", "TOMCAT_VERSION=9.0.43", "CATALINA_HOME=/opt/tomcat"], "ExposedPorts": {"8080/tcp": {}}, "Hostname": "dab1d08b299b", "Image": "prodimg", "Labels": {}, "OnBuild": null, "OpenStdin": false, "StdinOnce": false, "Tty": false, "User": "", "Volumes": null, "WorkingDir": "/opt/tomcat"}, "Created": "2021-03-21T19:36:00.499620532Z", "Driver": "overlay2", "ExecIDs": null, "GraphDriver": {"Data": {"LowerDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748-init/diff:/var/lib/docker/overlay2/613a8587ad1136ad9a7bcf2c2cb9bee0e5235bec97f87350fecf185ff59fd3e4/diff:/var/lib/docker/overlay2/8a71216a59975a7f2d5d3b882cdcc1d40c87feda4f687c879f7a429ec9a505c9/diff:/var/lib/docker/overlay2/1d6f1bbc7ae4ac29583bba9b0554a301881421a9c2298558c96a235d08436824/diff:/var/lib/docker/overlay2/cf7dbad0b45ccf86c1b07e9838ea67b3476bab016d585c6aed3fb3cd11235317/diff:/var/lib/docker/overlay2/37a9c59931bb7952f7047148bab7d7f278dde78f0abf4fed70399f5dffb7a13f/diff:/var/lib/docker/overlay2/356dc8b6f2576afa3811c6e630a6cd81e9b266fb64ab3f741cf61021a5119ec9/diff:/var/lib/docker/overlay2/5629846b4ba98079b43546ea490c089b6ddeb5a916fe4c72c795fe47233c1f0f/diff", "MergedDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/merged", "UpperDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/diff", "WorkDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/work"}, "Name": "overlay2"}, "HostConfig": {"AutoRemove": false, "Binds": [], "BlkioDeviceReadBps": null, "BlkioDeviceReadIOps": null, "BlkioDeviceWriteBps": null, "BlkioDeviceWriteIOps": null, "BlkioWeight": 0, "BlkioWeightDevice": null, "CapAdd": null, "CapDrop": null, "Cgroup": "", "CgroupParent": "", "ConsoleSize": [0, 0], "ContainerIDFile": "", "CpuCount": 0, "CpuPercent": 0, "CpuPeriod": 0, "CpuQuota": 0, "CpuRealtimePeriod": 0, "CpuRealtimeRuntime": 0, "CpuShares": 0, "CpusetCpus": "", "CpusetMems": "", "DeviceCgroupRules": null, "Devices": null, "DiskQuota": 0, "Dns": null, "DnsOptions": null, "DnsSearch": null, "ExtraHosts": null, "GroupAdd": null, "IOMaximumBandwidth": 0, "IOMaximumIOps": 0, "Init": false, "IpcMode": "shareable", "Isolation": "", "KernelMemory": 0, "Links": null, "LogConfig": {"Config": {}, "Type": "json-file"}, "MaskedPaths": ["/proc/asound", "/proc/acpi", "/proc/kcore", "/proc/keys", "/proc/latency_stats", "/proc/timer_list", "/proc/timer_stats", "/proc/sched_debug", "/proc/scsi", "/sys/firmware"], "Memory": 0, "MemoryReservation": 0, "MemorySwap": 0, "MemorySwappiness": null, "NanoCpus": 0, "NetworkMode": "default", "OomKillDisable": false, "OomScoreAdj": 0, "PidMode": "", "PidsLimit": 0, "PortBindings": {"8080/tcp": [{"HostIp": "0.0.0.0", "HostPort": "8080"}]}, "Privileged": false, "PublishAllPorts": false, "ReadonlyPaths": ["/proc/bus", "/proc/fs", "/proc/irq", "/proc/sys", "/proc/sysrq-trigger"], "ReadonlyRootfs": false, "RestartPolicy": {"MaximumRetryCount": 0, "Name": ""}, "Runtime": "runc", "SecurityOpt": null, "ShmSize": 67108864, "UTSMode": "", "Ulimits": null, "UsernsMode": "", "VolumeDriver": "", "VolumesFrom": null}, "HostnamePath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/hostname", "HostsPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/hosts", "Id": "dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713", "Image": "sha256:d9d0a2b89cd075127dcbf2a810acc7edf167f5ffe3902ab4fd1a1bf59b9bc5cd", "LogPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713-json.log", "MountLabel": "", "Mounts": [], "Name": "/prodcont", "NetworkSettings": {"Bridge": "", "EndpointID": "e1dd6a80c75d0133a0f2dce7245b583ff09567baf0851a810148aef1118e1bb9", "Gateway": "172.17.0.1", "GlobalIPv6Address": "", "GlobalIPv6PrefixLen": 0, "HairpinMode": false, "IPAddress": "172.17.0.2", "IPPrefixLen": 16, "IPv6Gateway": "", "LinkLocalIPv6Address": "", "LinkLocalIPv6PrefixLen": 0, "MacAddress": "02:42:ac:11:00:02", "Networks": {"bridge": {"Aliases": null, "DriverOpts": null, "EndpointID": "e1dd6a80c75d0133a0f2dce7245b583ff09567baf0851a810148aef1118e1bb9", "Gateway": "172.17.0.1", "GlobalIPv6Address": "", "GlobalIPv6PrefixLen": 0, "IPAMConfig": null, "IPAddress": "172.17.0.2", "IPPrefixLen": 16, "IPv6Gateway": "", "Links": null, "MacAddress": "02:42:ac:11:00:02", "NetworkID": "5c6fce41f6e546fc5777e3794a7cca3a75bb2f78c13d799c7f7ecc69671c3b60"}}, "Ports": {"8080/tcp": [{"HostIp": "0.0.0.0", "HostPort": "8080"}]}, "SandboxID": "d7fcd1bcf022b38548b1a89c2efa50a3bdef6300291755f701f1e01cf631e68b", "SandboxKey": "/var/run/docker/netns/d7fcd1bcf022", "SecondaryIPAddresses": null, "SecondaryIPv6Addresses": null}, "Path": "catalina.sh", "Platform": "linux", "ProcessLabel": "", "ResolvConfPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/resolv.conf", "RestartCount": 0, "State": {"Dead": false, "Error": "", "ExitCode": 0, "FinishedAt": "0001-01-01T00:00:00Z", "OOMKilled": false, "Paused": false, "Pid": 11251, "Restarting": false, "Running": true, "StartedAt": "2021-03-21T19:36:01.019511475Z", "Status": "running"}}}, "changed": true, "container": {"AppArmorProfile": "docker-default", "Args": ["run"], "Config": {"AttachStderr": false, "AttachStdin": false, "AttachStdout": false, "Cmd": null, "Domainname": "", "Entrypoint": ["catalina.sh", "run"], "Env": ["PATH=/opt/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TOMCAT_MAJOR=9", "TOMCAT_VERSION=9.0.43", "CATALINA_HOME=/opt/tomcat"], "ExposedPorts": {"8080/tcp": {}}, "Hostname": "dab1d08b299b", "Image": "prodimg", "Labels": {}, "OnBuild": null, "OpenStdin": false, "StdinOnce": false, "Tty": false, "User": "", "Volumes": null, "WorkingDir": "/opt/tomcat"}, "Created": "2021-03-21T19:36:00.499620532Z", "Driver": "overlay2", "ExecIDs": null, "GraphDriver": {"Data": {"LowerDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748-init/diff:/var/lib/docker/overlay2/613a8587ad1136ad9a7bcf2c2cb9bee0e5235bec97f87350fecf185ff59fd3e4/diff:/var/lib/docker/overlay2/8a71216a59975a7f2d5d3b882cdcc1d40c87feda4f687c879f7a429ec9a505c9/diff:/var/lib/docker/overlay2/1d6f1bbc7ae4ac29583bba9b0554a301881421a9c2298558c96a235d08436824/diff:/var/lib/docker/overlay2/cf7dbad0b45ccf86c1b07e9838ea67b3476bab016d585c6aed3fb3cd11235317/diff:/var/lib/docker/overlay2/37a9c59931bb7952f7047148bab7d7f278dde78f0abf4fed70399f5dffb7a13f/diff:/var/lib/docker/overlay2/356dc8b6f2576afa3811c6e630a6cd81e9b266fb64ab3f741cf61021a5119ec9/diff:/var/lib/docker/overlay2/5629846b4ba98079b43546ea490c089b6ddeb5a916fe4c72c795fe47233c1f0f/diff", "MergedDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/merged", "UpperDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/diff", "WorkDir": "/var/lib/docker/overlay2/1bbd54121a5c6dc0fb4bd7565b5e1cfb36cec634ef0b3eb9187c8c3d176df748/work"}, "Name": "overlay2"}, "HostConfig": {"AutoRemove": false, "Binds": [], "BlkioDeviceReadBps": null, "BlkioDeviceReadIOps": null, "BlkioDeviceWriteBps": null, "BlkioDeviceWriteIOps": null, "BlkioWeight": 0, "BlkioWeightDevice": null, "CapAdd": null, "CapDrop": null, "Cgroup": "", "CgroupParent": "", "ConsoleSize": [0, 0], "ContainerIDFile": "", "CpuCount": 0, "CpuPercent": 0, "CpuPeriod": 0, "CpuQuota": 0, "CpuRealtimePeriod": 0, "CpuRealtimeRuntime": 0, "CpuShares": 0, "CpusetCpus": "", "CpusetMems": "", "DeviceCgroupRules": null, "Devices": null, "DiskQuota": 0, "Dns": null, "DnsOptions": null, "DnsSearch": null, "ExtraHosts": null, "GroupAdd": null, "IOMaximumBandwidth": 0, "IOMaximumIOps": 0, "Init": false, "IpcMode": "shareable", "Isolation": "", "KernelMemory": 0, "Links": null, "LogConfig": {"Config": {}, "Type": "json-file"}, "MaskedPaths": ["/proc/asound", "/proc/acpi", "/proc/kcore", "/proc/keys", "/proc/latency_stats", "/proc/timer_list", "/proc/timer_stats", "/proc/sched_debug", "/proc/scsi", "/sys/firmware"], "Memory": 0, "MemoryReservation": 0, "MemorySwap": 0, "MemorySwappiness": null, "NanoCpus": 0, "NetworkMode": "default", "OomKillDisable": false, "OomScoreAdj": 0, "PidMode": "", "PidsLimit": 0, "PortBindings": {"8080/tcp": [{"HostIp": "0.0.0.0", "HostPort": "8080"}]}, "Privileged": false, "PublishAllPorts": false, "ReadonlyPaths": ["/proc/bus", "/proc/fs", "/proc/irq", "/proc/sys", "/proc/sysrq-trigger"], "ReadonlyRootfs": false, "RestartPolicy": {"MaximumRetryCount": 0, "Name": ""}, "Runtime": "runc", "SecurityOpt": null, "ShmSize": 67108864, "UTSMode": "", "Ulimits": null, "UsernsMode": "", "VolumeDriver": "", "VolumesFrom": null}, "HostnamePath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/hostname", "HostsPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/hosts", "Id": "dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713", "Image": "sha256:d9d0a2b89cd075127dcbf2a810acc7edf167f5ffe3902ab4fd1a1bf59b9bc5cd", "LogPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713-json.log", "MountLabel": "", "Mounts": [], "Name": "/prodcont", "NetworkSettings": {"Bridge": "", "EndpointID": "e1dd6a80c75d0133a0f2dce7245b583ff09567baf0851a810148aef1118e1bb9", "Gateway": "172.17.0.1", "GlobalIPv6Address": "", "GlobalIPv6PrefixLen": 0, "HairpinMode": false, "IPAddress": "172.17.0.2", "IPPrefixLen": 16, "IPv6Gateway": "", "LinkLocalIPv6Address": "", "LinkLocalIPv6PrefixLen": 0, "MacAddress": "02:42:ac:11:00:02", "Networks": {"bridge": {"Aliases": null, "DriverOpts": null, "EndpointID": "e1dd6a80c75d0133a0f2dce7245b583ff09567baf0851a810148aef1118e1bb9", "Gateway": "172.17.0.1", "GlobalIPv6Address": "", "GlobalIPv6PrefixLen": 0, "IPAMConfig": null, "IPAddress": "172.17.0.2", "IPPrefixLen": 16, "IPv6Gateway": "", "Links": null, "MacAddress": "02:42:ac:11:00:02", "NetworkID": "5c6fce41f6e546fc5777e3794a7cca3a75bb2f78c13d799c7f7ecc69671c3b60"}}, "Ports": {"8080/tcp": [{"HostIp": "0.0.0.0", "HostPort": "8080"}]}, "SandboxID": "d7fcd1bcf022b38548b1a89c2efa50a3bdef6300291755f701f1e01cf631e68b", "SandboxKey": "/var/run/docker/netns/d7fcd1bcf022", "SecondaryIPAddresses": null, "SecondaryIPv6Addresses": null}, "Path": "catalina.sh", "Platform": "linux", "ProcessLabel": "", "ResolvConfPath": "/var/lib/docker/containers/dab1d08b299b921ddaa3ab6508db268c4d3afc2538a8f993dd5f21043e9ea713/resolv.conf", "RestartCount": 0, "State": {"Dead": false, "Error": "", "ExitCode": 0, "FinishedAt": "0001-01-01T00:00:00Z", "OOMKilled": false, "Paused": false, "Pid": 11251, "Restarting": false, "Running": true, "StartedAt": "2021-03-21T19:36:01.019511475Z", "Status": "running"}}}
[0m[0m
[0m[0mnull_resource.localexec (local-exec): PLAY RECAP *********************************************************************
[0m[0mnull_resource.localexec (local-exec): 35.228.16.221              : ok=7    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
[0m[0mnull_resource.localexec (local-exec): 35.228.93.183              : ok=6    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
[0m[0mnull_resource.localexec (local-exec): localhost                  : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
[0m[0m
[0m[1mnull_resource.localexec: Creation complete after 2m35s [id=4680887297902166430][0m[0m
[33m
[1m[33mWarning: [0m[0m[1mInterpolation-only expressions are deprecated[0m

[0m  on main.tf line 67, in resource "google_compute_instance" "prod":
  67:     private_key = [4m"${file("~/.ssh/id_rsa")}"[0m
[0m
Terraform 0.11 and earlier required all non-constant expressions to be
provided via interpolation syntax, but this pattern is now deprecated. To
silence this warning, remove the "${ sequence from the start and the }"
sequence from the end of this expression, leaving just the inner expression.

Template interpolation syntax is still used to construct strings from
expressions when the template includes multiple interpolation sequences or a
mixture of literal strings and interpolations. This deprecation applies only
to templates that consist entirely of a single interpolation sequence.
[0m[0m
[0m[1m[32m
Apply complete! Resources: 3 added, 0 changed, 0 destroyed.[0m
[0m[1m[32m
Outputs:

prod_ip_addr = "35.228.16.221"[0m
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Terraform destroy dev)
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ terraform destroy -target=google_compute_instance.dev -auto-approve
[0m[1mnull_resource.localexec: Destroying... [id=4680887297902166430][0m[0m
[0m[1mnull_resource.localexec: Destruction complete after 0s[0m[0m
[0m[1mgoogle_compute_instance.dev: Destroying... [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-dev-001][0m[0m
[0m[1mgoogle_compute_instance.dev: Still destroying... [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-dev-001, 10s elapsed][0m[0m
[0m[1mgoogle_compute_instance.dev: Still destroying... [id=projects/tough-racer-302813/zones/europe-north1-a/instances/instance-dev-001, 20s elapsed][0m[0m
[0m[1mgoogle_compute_instance.dev: Destruction complete after 22s[0m[0m
[33m
[1m[33mWarning: [0m[0m[1mResource targeting is in effect[0m

[0mYou are creating a plan with the -target option, which means that the result
of this plan may not represent all of the changes requested by the current
configuration.

The -target option is not for routine use, and is provided only for
exceptional situations such as recovering from errors or mistakes, or when
Terraform specifically suggests to use it as part of an error message.
[0m[0m
[33m
[1m[33mWarning: [0m[0m[1mApplied changes may be incomplete[0m

[0mThe plan was created with the -target option in effect, so some changes
requested in the configuration may have been ignored and the output values may
not be fully updated. Run the following command to verify that no other
changes are pending:
    terraform plan

Note that the -target option is not suitable for routine use, and is provided
only for exceptional situations such as recovering from errors or mistakes, or
when Terraform specifically suggests to use it as part of an error message.
[0m[0m
[33m
[1m[33mWarning: [0m[0m[1mInterpolation-only expressions are deprecated[0m

[0m  on main.tf line 67, in resource "google_compute_instance" "prod":
  67:     private_key = [4m"${file("~/.ssh/id_rsa")}"[0m
[0m
Terraform 0.11 and earlier required all non-constant expressions to be
provided via interpolation syntax, but this pattern is now deprecated. To
silence this warning, remove the "${ sequence from the start and the }"
sequence from the end of this expression, leaving just the inner expression.

Template interpolation syntax is still used to construct strings from
expressions when the template includes multiple interpolation sequences or a
mixture of literal strings and interpolations. This deprecation applies only
to templates that consist entirely of a single interpolation sequence.
[0m[0m
[0m[1m[32m
Destroy complete! Resources: 2 destroyed.[0m
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS