# Basic provisioning example
- name: Beginning
  hosts: localhost
  gather_facts: False
  tasks:
    - name: create AWS DEV instance
      ec2:
        instance_type: t2.micro
        image: ami-08962a4068733a2b6
        region: us-east-2
        wait: true
        count: 1
        vpc_subnet_id: subnet-9ec182d2
        assign_public_ip: yes
      register: ec2

    - name: create AWS PROD instance
      ec2:
        instance_type: t2.micro
        image: ami-042e8287309f5df03
        region: us-east-1
        wait: true
        count: 1
        vpc_subnet_id:  subnet-702d4a51
        assign_public_ip: yes
      register: ec2

    - name: Add new instances to host group
      add_host:
        hostname: "{{ item.public_ip }}"
        groupname: launched
        msg: "{{ ec2.instances }}"
        msg: "{{ item.public_ip }}"
      loop: "{{ ec2.instances }}"

      #    - name: Wait for SSH to come up
      #delegate_to: "{{ item.public_dns_name }}"
      # wait_for_connection:
      #  delay: 60
      #  timeout: 320
      #loop: "{{ ec2.instances }}"
      #
#- name: Configure instance(s)
#  hosts: launched
# become: True
#  gather_facts: True
#  roles:
#    - my_awesome_role
#    - my_awesome_test

- name: Terminate instances
  hosts: localhost
  tasks:
    - name: Terminate instances that were previously launched '{{ ec2.instance_ids }}'
      ec2:
        state: 'absent'
        region: us-east-2
        instance_ids: '{{ ec2.instance_ids }}'
    - name: Terminate instances that were previously launched '{{ ec2.instance_ids }}'
      ec2:
        state: 'absent'
        region: us-east-1
        instance_ids: '{{ ec2.instance_ids }}'


